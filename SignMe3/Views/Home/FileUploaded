@{
    ViewData["Title"] = "Home Page";
}

<div class="row">
    

    @*<iframe src="http://localhost:64098/resources/file.pdf" frameborder="0"></iframe>*@
    <form action="/home/UploadFile"
          class="dropzone"
          id="my-awesome-dropzone">
        <div class="dz-message">Drop a file here to Sign</div>
    </form>

    <canvas style="border:1px solid black;visibility:hidden" id="the-canvas"></canvas>
    @*<img id="drag" style="position:absolute" src="~/images/Matt Signature-small.png" alt="Alternate Text" />*@
    <style>
        #the-canvas {
            cursor: pointer;
        }
        form {
            border-radius: 5px;
            font-family: cursive;
            font-size: 2em;
        }
        .row{
            margin-top:25px;    
        }
    </style>
    @section scripts{
        <script>
            //$(document).on('mousemove', function (e) {
            //    $('#drag').css({
            //        left: e.pageX,
            //        top: e.pageY + 10
            //    });
            //});


            document.querySelector("#the-canvas").addEventListener('click', function (e) { 
                console.log("click");
                var x = e.pageX - this.offsetLeft;
                var y = e.pageY - this.offsetTop;
                $.blockUI();
                
                //x -= this.offsetLeft;
                //y -= this.offsetTop;
                //console.log(x)
                //document.location = '?h=' + x + '&v=' + y;//

                $.get('/home/UpdateImage' + '?h=' + x + '&v=' + y).then(function () {
                    loadPDF().then(function () { 

                        $.unblockUI();
                    });
                
                })
            })


            window.onload = function () {
                console.log("Loading")
                //loadPDF();
            };

            var loadPDF = function () {
                var loadingTask = PDFJS.getDocument('images/modified.pdf');
                return loadingTask.promise.then(function (pdf) {
                    console.log('PDF loaded');

                    // Fetch the first page
                    var pageNumber = 1;
                    pdf.getPage(pageNumber).then(function (page) {
                        console.log('Page loaded');

                        var scale = 1.5;
                        var viewport = page.getViewport(scale);

                        // Prepare canvas using PDF page dimensions
                        var canvas = document.getElementById('the-canvas');
                        var context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        // Render PDF page into canvas context
                        var renderContext = {
                            canvasContext: context,
                            viewport: viewport
                        };
                        var renderTask = page.render(renderContext);
                        renderTask.then(function () {
                            console.log('Page rendered');
                        });
                    });
                }, function (reason) {
                    // PDF loading error
                    console.error(reason);
                });

            };
            
        </script>

    }

</div>
